# yaml2pbip Model Configuration Example
# This file defines the semantic model structure including tables, measures, and relationships

version: 1

model:
  name: SalesModel
  culture: en-US

  tables:
    # ========================================
    # Measure Table: Cross-table measures
    # ========================================
    - name: Measure Table
      kind: measureTable
      measures:
        - name: Total Profit
          expression: "SUMX ( FactSales, FactSales[Revenue] - FactSales[Cost] )"
          formatString: "#,0.0"
          description: "Total profit across all sales"
        
        - name: Profit Margin %
          expression: |
            DIVIDE (
              [Total Profit],
              [Total Revenue],
              0
            ) * 100
          formatString: "0.00%"
          description: "Profit margin percentage"
        
        - name: YTD Revenue
          expression: |
            TOTALYTD (
              [Total Revenue],
              DimDate[Date]
            )
          formatString: "$#,0"
          description: "Year-to-date revenue"

    # ========================================
    # Dimension Table: Date dimension
    # ========================================
    - name: DimDate
      kind: table
      column_policy: select_only
      description: "Date dimension table for time intelligence"
      columns:
        - name: Date
          dataType: dateTime
          description: "Calendar date"
        
        - name: Year
          dataType: int64
          description: "Calendar year"
        
        - name: Quarter
          dataType: int64
          description: "Calendar quarter (1-4)"
        
        - name: Month
          dataType: int64
          description: "Month number (1-12)"
        
        - name: MonthName
          dataType: string
          description: "Month name (January, February, etc.)"
        
        - name: DayOfWeek
          dataType: int64
          description: "Day of week (1=Sunday, 7=Saturday)"
        
        - name: DayName
          dataType: string
          description: "Day name (Monday, Tuesday, etc.)"
        
        - name: IsWeekend
          dataType: boolean
          description: "True if Saturday or Sunday"
      
      partitions:
        - name: Full
          mode: import
          use: sf_main
          navigation:
            database: SALES
            schema: DIM
            table: DATE
          description: "Full date dimension import"

    # ========================================
    # Dimension Table: Product dimension
    # ========================================
    - name: DimProduct
      kind: table
      column_policy: select_only
      description: "Product dimension table"
      columns:
        - name: ProductKey
          dataType: int64
          description: "Product surrogate key"
        
        - name: ProductID
          dataType: string
          description: "Product business key"
        
        - name: ProductName
          dataType: string
          description: "Product name"
        
        - name: Category
          dataType: string
          description: "Product category"
        
        - name: SubCategory
          dataType: string
          description: "Product sub-category"
        
        - name: UnitPrice
          dataType: decimal
          formatString: "$#,0.00"
          description: "Standard unit price"
      
      partitions:
        - name: Full
          mode: import
          use: sf_main
          navigation:
            database: SALES
            schema: DIM
            table: PRODUCT
          description: "Full product dimension import"
      
      measures:
        - name: Product Count
          expression: "COUNTROWS ( DimProduct )"
          formatString: "#,0"
          description: "Total number of products"

    # ========================================
    # Fact Table: Sales transactions
    # ========================================
    - name: FactSales
      kind: table
      column_policy: keep_all
      description: "Sales transactions fact table"
      columns:
        - name: OrderID
          dataType: int64
          description: "Order identifier"
        
        - name: OrderLineID
          dataType: int64
          description: "Order line identifier"
        
        - name: OrderDate
          dataType: dateTime
          description: "Date of order"
        
        - name: ProductKey
          dataType: int64
          description: "Foreign key to DimProduct"
        
        - name: Quantity
          dataType: int64
          description: "Quantity sold"
        
        - name: UnitPrice
          dataType: decimal
          formatString: "$#,0.00"
          description: "Unit price at time of sale"
        
        - name: Revenue
          dataType: decimal
          formatString: "$#,0.00"
          description: "Total revenue (Quantity * UnitPrice)"
        
        - name: Cost
          dataType: decimal
          formatString: "$#,0.00"
          description: "Total cost"
        
        - name: Discount
          dataType: decimal
          formatString: "$#,0.00"
          description: "Discount amount applied"
      
      measures:
        - name: Total Orders
          expression: "DISTINCTCOUNT ( FactSales[OrderID] )"
          formatString: "#,0"
          description: "Count of distinct orders"
        
        - name: Total Revenue
          expression: "SUM ( FactSales[Revenue] )"
          formatString: "$#,0"
          description: "Sum of revenue"
        
        - name: Total Cost
          expression: "SUM ( FactSales[Cost] )"
          formatString: "$#,0"
          description: "Sum of cost"
        
        - name: Total Quantity
          expression: "SUM ( FactSales[Quantity] )"
          formatString: "#,0"
          description: "Total quantity sold"
        
        - name: Average Order Value
          expression: |
            DIVIDE (
              [Total Revenue],
              [Total Orders],
              0
            )
          formatString: "$#,0.00"
          description: "Average revenue per order"
      
      partitions:
        - name: CurrentYear
          mode: import
          use: sf_main
          description: "Sales data for current year using native SQL"
          nativeQuery: |
            SELECT 
              OrderID,
              OrderLineID,
              OrderDate,
              ProductKey,
              Quantity,
              UnitPrice,
              Revenue,
              Cost,
              Discount
            FROM SALES.FACT.SALES
            WHERE OrderDate >= DATEADD(year, -1, CURRENT_DATE())
              AND OrderDate < CURRENT_DATE()

  # ========================================
  # Relationships
  # ========================================
  relationships:
    # Date relationships
    - from: FactSales[OrderDate]
      to: DimDate[Date]
      cardinality: manyToOne
      crossFilter: single
      description: "Links sales to date dimension"
    
    # Product relationships
    - from: FactSales[ProductKey]
      to: DimProduct[ProductKey]
      cardinality: manyToOne
      crossFilter: single
      description: "Links sales to product dimension"

  # ========================================
  # Security Roles (empty for now)
  # ========================================
  roles: []